@model List<RentACar.Application.DTOs.CarDto>
@{
    ViewData["Title"] = "Manage Cars";
}
<link rel="stylesheet" href="~/css/cars.css" />
<h2 class="mb-3">Manage Cars</h2>
<div class="d-flex justify-content-between mb-3">
    <form class="d-flex" method="get">
        <input type="text" name="search" value="@ViewBag.Search" class="form-control me-2" placeholder="Search..." />
        <button type="submit" class="btn btn-secondary">Search</button>
    </form>
    <button type="button" id="addCar" class="btn btn-primary">Add Car</button>
</div>
<table class="table table-striped table-dark">
    <thead>
        <tr>
            <th>Plate #</th>
            <th>Model</th>
            <th>Year</th>
            <th>Color</th>
            <th>Price/Day</th>
            <th>Available</th>
            <th>Category</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
    @foreach (var car in Model)
    {
        <tr>
            <td>@car.PlateNumber</td>
            <td>@car.ModelName</td>
            <td>@car.ModelYear</td>
            <td>@car.Color</td>
            <td>@car.PricePerDay?.ToString("C")</td>
            <td class="text-center">
                @if (car.IsAvailable)
                {
                    <i class="fas fa-check text-success"></i>
                }
                else
                {
                    <i class="fas fa-times text-danger"></i>
                }
            </td>
            <td>@car.CategoryName</td>
            <td>
                <a href="#" class="text-warning me-2 edit-car" data-id="@car.CarId"><i class="fas fa-edit"></i></a>
                <a href="#" class="text-danger delete-car" data-id="@car.CarId"><i class="fas fa-trash"></i></a>
            </td>
        </tr>
    }
    </tbody>
</table>
<nav>
    <ul class="pagination">
        @for (var i = 1; i <= (int)ViewBag.TotalPages; i++)
        {
            <li class="page-item @(i == (int)ViewBag.Page ? "active" : "")">
                <a class="page-link" href="?page=@i&search=@ViewBag.Search">@i</a>
            </li>
        }
    </ul>
</nav>

<div id="modalContainer" class="modal fade" tabindex="-1"></div>

@section Scripts {
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.3/js/bootstrap.bundle.min.js"></script>
    <script>
        function loadModal(url, title) {
            $.get(url, function (data) {
                var modal = $('#modalContainer');
                modal.html('<div class="modal-dialog"><div class="modal-content">' +
                    '<div class="modal-header"><h5 class="modal-title">' + title +
                    '</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>' +
                    '<div class="modal-body">' + data + '</div></div></div>');
                var bsModal = new bootstrap.Modal(modal[0]);
                bsModal.show();
            });
        }
        $('#addCar').click(function () { loadModal('/Car/Add', 'Add Car'); });
        $(document).on('click', '.edit-car', function (e) {
            e.preventDefault();
            loadModal('/Car/Edit/' + $(this).data('id'), 'Edit Car');
        });
        $(document).on('click', '.delete-car', function (e) {
            e.preventDefault();
            loadModal('/Car/Delete/' + $(this).data('id'), 'Delete Car');
        });
    </script>
}
